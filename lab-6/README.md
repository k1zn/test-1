# ЛР-6 - Рефакторинг

## Какие проблемы качества были найдены

1. **Длинная функция** - `process_checkout` содержала ~60 строк, что затрудняло понимание
2. **Магические числа** - константы `0.21`, `0.10`, `0.20`, `200`, `100`, `50` были разбросаны по коду
3. **Отсутствие декомпозиции** - вся логика (валидация, подсчёты, обработка) находилась в одной функции
4. **Низкая читаемость** - приходилось читать всю функцию целиком, чтобы понять её работу
5. **Смешение уровней абстракции** - детали валидации, бизнес-логика и форматирование вперемешку

## Какие рефакторинги были применены

1. **Разбиение методов** - разбили `process_checkout` на отдельные функции:
   - `parse_request()` - разбор запроса
   - `validate_request()` - валидация
   - `validate_items()` - валидация товаров
   - `calculate_subtotal()` - подсчёт subtotal
   - `calculate_discount()` - расчёт скидки
   - `calculate_tax()` - расчёт налога
   - `generate_order_id()` - генерация ID

2. **Извлечение констант** - все магические числа вынесены в константы в начале файла

3. **Композиция метода** - главная функция стала читаться как сценарий сверху вниз

## Что стало проще читать и менять

- Функция `process_checkout` сократилась с ~60 до ~20 строк
- Код читается как последовательность понятных шагов
- Изменение ставки налога - правка одной константы
- Добавление нового купона - правка только функции `calculate_discount()`
- Каждую часть логики можно тестировать отдельно
- Функции можно переиспользовать в других местах